## 何为异常

异常检测是一种**用于识别不符合预期行为的异常模式的技术**，又称之为异常值检测。在商业中也有许多应用，如网络入侵检测（识别可能发出黑客攻击的网络流量中的特殊模式）、系统健康性监测、信用卡交易欺诈检测、设备故障检测、风险识别等。这里，将异常分为三种：

1. **数据点异常**：如果样本点与其他数据相距太远，则单个数据实例是异常的。业务用例：根据“支出金额”检测信用卡欺诈。
2. **上下文异常**：在时间序列数据中的异常行为。业务用例：旅游购物期间信用卡的花费比平时高出好多倍属于正常情况，但如果是被盗刷卡，则属于异常。
3. **集合异常**：单个数据难以区分，只能根据一组数据来确定行为是否异常。业务用例：蚂蚁搬家式的拷贝文件，这种异常通常属于潜在的网络攻击行为。

## 异常检测的难点

- 不能明确定义何为正常，何为异常，在某些领域正常和异常并没有明确的界限；
- 数据本身存在噪声，致使噪声和异常难以区分；
- 正常行为并不是一成不变，也会随着时间演化，如正常用户被盗号之后，进行一系列的非法操作；
- 标记数据获取难：没有数据，再好的算法也是无用。



## 基于统计的异常值检测

### MA滑动平均法

识别数据不规则性的最简单的方法是标记偏离分布的数据点，包括平均值、中值、分位数和模式。假定异常数据点是偏离平均值的某个标准偏差，那么我们可以计算时间序列数据滑动窗口下的局部平均值，通过平均值来确定偏离程度。这被技术称为**滑动平均法**(moving average，MA)，旨在平滑短期波动并突出长期波动。滑动平均还包括累加移动平均、加权移动平均、指数加权移动平均、双指数平滑、三指数平滑等，在数学上，nn周期简单移动平均也可以定义为“低通滤波器”。

缺点：

- 数据中可能存在与异常行为类似的噪声数据，所以正常行为和异常行为之间的界限通常不明显；
- 异常或正常的定义可能经常发生变化，因为恶意攻击者不断适应自己。因此，基于移动平均值的阈值可能并不总是适用。

### 3-Sigma

3-Sigma原则又称为拉依达准则，该准则定义如下：

> 假设一组检测数据只含有随机误差，对原始数据进行计算处理得到标准差，然后按一定的概率确定一个区间，认为误差超过这个区间的就属于异常值。

![img](https://www.csuldw.com/assets/articleImg/2019/3-sigma-all.png)

使用3-Sigma的前提是数据服从正态分布（当然如果x不服从正态分布，可以使用log将其转为正态分布，详细参阅[Log Normal Distribution](https://en.wikipedia.org/wiki/Log-normal_distribution)），满足这个条件之后，在3-Sigma范围(μ−3σ,μ+3σ)(μ−3σ,μ+3σ)内`99.73%`的为正常数据，其中σσ代表标准差,μμ代表均值，x=μx=μ为图形的对称轴。下面是3-Sigma的Python实现。

## 基于密度的异常检测

基于密度的异常检测有一个先决条件，即正常的数据点呈现“物以类聚”的聚合形态，正常数据出现在密集的邻域周围，而异常点偏离较远。对于这种场景，我们可以计算得分来评估最近的数据点集，这种得分可以使用Eucledian距离或其它的距离计算方法，具体情况需要根据数据类型来定：类别型或是数字型。

### 局部异常因子算法

#### Local Outlier Factor原理

局部异常因子算法，全称Local Outlier Factor（简写LOF)。LOF算法是一种无监督的异常检测方法，它计算给定数据点相对于其邻居的局部密度偏差。每个样本的异常分数称为局部异常因子。异常分数是局部的，取决于样本相对于周围邻域的隔离程度。确切地说，局部性由`k`近邻给出，并使用距离估计局部密度。通过将样本的局部密度与其邻居的局部密度进行比较，可以识别密度明显低于其邻居的样本,，这些样本就被当做是异常样本点。







## 参考

- [八大无监督异常检测技术](https://www.csuldw.com/2019/03/24/2019-03-24-anomaly-detection-introduction/)

